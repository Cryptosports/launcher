<h2 *ngIf="!isExtSignUp" style="margin-top: 0;">Sign in</h2>
<h2 *ngIf="isExtSignUp" style="margin-top: 0;">
	Choose an account username
</h2>

<mat-card
	*ngIf="errorMessage"
	class="bg-warn"
	style="
		margin-bottom: 16px;
		color: #fff;
		display: flex;
		vertical-align: middle;
	"
>
	<mat-icon style="margin-top: -3px; margin-right: 8px;">
		error_outline
	</mat-icon>
	{{ errorMessage }}
</mat-card>

<form *ngIf="!isExtSignUp" [formGroup]="signInForm" (ngSubmit)="onSubmit()">
	<mat-form-field style="width: 100%;">
		<input
			matInput
			placeholder="Email or username"
			required
			formControlName="username"
		/>
		<mat-error *ngIf="signInForm.hasError('required', 'username')">
			Email or username is required
		</mat-error>
		<mat-error *ngIf="signInForm.hasError('minlength', 'username')">
			Email or username is too short
		</mat-error>
		<mat-error *ngIf="signInForm.hasError('maxlength', 'username')">
			Email or username is too long
		</mat-error>
	</mat-form-field>

	<mat-form-field style="width: 100%;">
		<input
			matInput
			type="password"
			placeholder="Password"
			required
			formControlName="password"
		/>
		<mat-error *ngIf="signInForm.hasError('required', 'password')">
			Password is required
		</mat-error>
		<mat-error *ngIf="signInForm.hasError('minlength', 'username')">
			Password is too short
		</mat-error>
		<mat-error *ngIf="signInForm.hasError('maxlength', 'username')">
			Password is too long
		</mat-error>
	</mat-form-field>

	<div style="margin: 16px 0;"></div>

	<button
		type="submit"
		mat-flat-button
		color="primary"
		[disabled]="signInForm.invalid || isLoading"
	>
		Sign in
	</button>
	<span style="margin: 0 4px;"></span>
	<button
		type="button"
		mat-button
		(click)="onSignUp()"
		[disabled]="isLoading"
	>
		Create a new account
	</button>
	<span style="margin: 0 4px;"></span>
	<button
		type="button"
		mat-button
		(click)="onResetPassword()"
		[disabled]="isLoading"
	>
		Forgot password
	</button>

	<div style="margin: 8px 0;"></div>

	<span *ngFor="let service of extServices" style="margin-right: 8px;">
		<button
			type="button"
			mat-stroked-button
			(click)="onSignInExt(service.toLowerCase())"
			[disabled]="isLoading"
			style="margin-bottom: 8px;"
		>
			<div [class]="'icon-' + service.toLowerCase()"></div>
			{{ service }}
		</button>
	</span>
</form>

<form *ngIf="isExtSignUp" [formGroup]="extSignUpForm" (ngSubmit)="onSubmit()">
	<table style="margin-bottom: 16px;">
		<tr>
			<td>
				<img
					style="margin-right: 8px;"
					class="user-image"
					[src]="extImageUrl"
				/>
			</td>
			<td>
				<p>
					Using <b>{{ extEmail }}</b>
				</p>
			</td>
		</tr>
	</table>

	<mat-form-field style="width: 100%;">
		<input
			matInput
			placeholder="Username"
			required
			formControlName="username"
		/>
		<mat-error *ngIf="extSignUpForm.hasError('required', 'username')">
			Username is required
		</mat-error>
		<mat-error *ngIf="extSignUpForm.hasError('minlength', 'username')">
			Username is too short
		</mat-error>
		<mat-error *ngIf="extSignUpForm.hasError('maxlength', 'username')">
			Username is too long
		</mat-error>
		<mat-error *ngIf="extSignUpForm.hasError('badCharacters', 'username')">
			Letters, numbers and underscores only
		</mat-error>
	</mat-form-field>

	<div style="margin: 16px 0;"></div>

	<button
		type="submit"
		mat-flat-button
		color="primary"
		[disabled]="extSignUpForm.invalid || isLoading"
	>
		Create a new account
	</button>
</form>

<div *ngIf="isLoading">
	<br />
	<mat-progress-bar mode="indeterminate"></mat-progress-bar>
</div>
